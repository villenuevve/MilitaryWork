<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>–Ü—Å—Ç–æ—Ä—ñ—è –≤–∏—è–≤–ª–µ–Ω—å</title>
    <link rel="stylesheet" href="{{ url_for('static', path='style.css') }}">
    <link rel="icon" href="https://cdn-icons-png.flaticon.com/256/2785/2785693.png" type="image/png">
</head>
<body>
    <div class="container fade-in">
        <h1>–Ü—Å—Ç–æ—Ä—ñ—è –≤–∏—è–≤–ª–µ–Ω—å</h1>
        <div class="export-buttons">
            <a href="/export/pdf" class="btn">‚¨áÔ∏è –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ PDF</a>
            <a href="/export/csv" class="btn">üìä –ï–∫—Å–ø–æ—Ä—Ç—É–≤–∞—Ç–∏ CSV</a>
        </div>

        <form method="get" action="/history" class="filter-form">
            <label for="from">–í—ñ–¥:</label>
            <input type="date" name="from" id="from" value="{{ request.query_params.get('from', '') }}">
            
            <label for="to">–î–æ:</label>
            <input type="date" name="to" id="to" value="{{ request.query_params.get('to', '') }}">
        
            <label for="class">–ö–ª–∞—Å —Ç–µ—Ö–Ω—ñ–∫–∏:</label>
            <select name="class" id="class">
                <option value="">–£—Å—ñ</option>
                <option value="fire_engine" {% if request.query_params.get('class') == 'fire_engine' %}selected{% endif %}>üöí –ü–æ–∂–µ–∂–Ω–∞</option>
                <option value="ambulance" {% if request.query_params.get('class') == 'ambulance' %}selected{% endif %}>üöë –®–≤–∏–¥–∫–∞</option>
                <option value="tractor" {% if request.query_params.get('class') == 'tractor' %}selected{% endif %}>üöú –¢—Ä–∞–∫—Ç–æ—Ä</option>
                <option value="excavator" {% if request.query_params.get('class') == 'excavator' %}selected{% endif %}>‚õèÔ∏è –ï–∫—Å–∫–∞–≤–∞—Ç–æ—Ä</option>
            </select>
        
            <button type="submit">
                <span>üîç</span> –§—ñ–ª—å—Ç—Ä—É–≤–∞—Ç–∏
            </button>            
        </form>
            
        {% if detections %}
            <table class="detection-table">
                <thead>
                    <tr>
                        <th>–ó–æ–±—Ä–∞–∂–µ–Ω–Ω—è</th>
                        <th>–ö–ª–∞—Å</th>
                        <th>–¢–æ—á–Ω—ñ—Å—Ç—å</th>
                        <th>GPS</th>
                        <th>–î–∞—Ç–∞</th>
                        <th>–î—ñ—ó</th>
                    </tr>
                </thead>
                <tbody>
                    {% for det in detections %}
                    <tr>
                        <td>
                            {% if det.image_url %}
                                <img src="{{ det.image_url }}" alt="img" width="90" style="border-radius: 6px;">
                            {% else %}
                                üîò
                            {% endif %}
                        </td>
                        <td>{{ det.predicted_class }}</td>
                        <td>{{ "%.2f" | format(det.confidence) }}%</td>
                        <td>{{ det.gps or "‚Äî" }}</td>
                        <td>{{ det.timestamp }}</td>
                        <td>
                            <form action="/delete/{{ det.id }}" method="post">
                                <button type="submit" class="delete-btn">–í–∏–¥–∞–ª–∏—Ç–∏</button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <div class="empty-message">
                <p>ü§ñ –Ü—Å—Ç–æ—Ä—ñ—è –ø–æ–∫–∏ —â–æ –ø–æ—Ä–æ–∂–Ω—è. –ó–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è –¥–ª—è –∞–Ω–∞–ª—ñ–∑—É!</p>
            </div>
        {% endif %}

        <a href="/" class="back-btn">‚Üê –ù–∞ –≥–æ–ª–æ–≤–Ω—É</a>
    </div>
</body>
</html>
